<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./index.css" />
    <title>about this</title>
  </head>
  <style>
    main {
      padding-top: 30px;
    }
  </style>
  <body>
    <nav>
      <div id="nav-title">
        <div id="nav-links">
          <a href="./index.html">charlee</a>
          <h1>about this</h1>
          <a href="./about.html">about me</a>
        </div>
        <footer>antoni<br />chmiela<br />2025</footer>
      </div>
    </nav>
    <main>
      <p>
        charlee is a very basic peer-to-peer browser-based chat. it makes use of
        <a href="https://peerjs.com" target="_blank">PeerJS</a> for handling
        peers and connections and
        <a href="https://animejs.com" target="_blank">anime.js</a> for those fun
        draggable elements, but apart from that doesn't use anything other than
        basic HTML, CSS and JavaScript.
      </p>

      <p>
        you can look at the code
        <a
          href="https://github.com/ab9st8/wdai/tree/main/proj1"
          target="_blank"
        >
          here</a
        >.
      </p>

      <p>
        the name is pronounced the way you would expect. it comes from the
        Spanish
        <a href="https://en.wiktionary.org/wiki/charlar#Verb_2" target="_blank"
          >charlar</a
        >, meaning to chit-chat, to chatter.
      </p>

      <h1>how to use</h1>
      <p>
        when you first open up charlee, you'll be prompted to input the peer id
        of the user you want to chat with. they can share that with you over an
        external communication channel, and then you can paste it into the
        input.
      </p>

      <p>
        you won't be able to send messages to them until they do the same thing
        on their side symmetrically.
      </p>

      <p>once you're good to go, you can start chatting!</p>

      <p>if you have any questions, feel free to write to me below.</p>

      <form id="email-form">
        <div id="form-header">
          <input
            type="email"
            placeholder="your email"
            id="sender-email"
            required
          />
          <select id="subject-select" required>
            <option value="bug">bug</option>
            <option value="suggestion">suggestion</option>
            <option value="other">other</option>
          </select>
        </div>
        <textarea
          id="message-body"
          placeholder="your message"
          required
          rows="3"
        ></textarea>
        <button type="submit" id="submit-email">send email</button>
      </form>
    </main>
    <div id="toggle-button-wrapper">
      <span id="drag-handle">move</span>
      <button
        type="button"
        id="toggle-sidebar-button"
        onclick="onToggleSidebar(footerDraggable)"
      >
        close
      </button>
    </div>
  </body>

  <script type="module" src="/draggablesSetup.js"></script>
  <script type="module">
    import { onToggleSidebar } from "./lib.js";

    async function sendEmail() {
      const emailEl = document.querySelector("#sender-email");
      const email = ((emailEl && emailEl.value) || "").trim();

      // <https://emailregex.com/> :P
      const emailPattern =
        /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

      if (!emailPattern.test(email)) {
        if (emailEl) {
          emailEl.value = "";
          emailEl.placeholder = "email must be valid!";
          emailEl.focus();
        }
      }

      const subject = document.getElementById("subject-select")?.value || "";
      const body = document.getElementById("message-body")?.value || "";

      let res;

      try {
        res = await fetch("http://localhost:6969/notification", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, subject, body }),
        });
      } catch (err) {
      } finally {
        if (!res.ok) {
        } // disturb the user not......

        const submitBtn = document.getElementById("submit-email");
        if (submitBtn) {
          submitBtn.textContent = "sent";
          setTimeout(() => {
            submitBtn.textContent = "send email";
          }, 3000);
        }
        const msgEl = document.getElementById("message-body");
        if (msgEl) msgEl.value = "";
      }
    }

    const emailForm = document.getElementById("email-form");
    if (emailForm) {
      emailForm.addEventListener("submit", (event) => {
        event.preventDefault();
        sendEmail();
      });
    }

    window.onToggleSidebar = onToggleSidebar;
  </script>
</html>
